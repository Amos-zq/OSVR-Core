{
  "$schema": "http://json-schema.org/draft-04/schema#",
  "title": "OSVR Device description file",
  "description": "This schema documents and guides creation of a device description file, that both describes the interfaces available, and provides semantic mappings to those interfaces.",
  "definitions": {
    "tracker": {
      "type": "object",
      "title": "Tracker interface description",
      "description": "Describes properties of the tracker interface provided by this device.",
      "properties": {
        "count": {
          "title": "Number of sensors",
          "description": "number of tracker sensors, if bounded and known",
          "type": "integer",
          "minimum": 1
        },
        "bounded": {
          "title": "Sensor count bounded?",
          "description": "true if the IDs of sensors reporting are bounded (usually known ahead of time) or false if they are unbounded (new ID for each item tracked, for instance)",
          "type": "boolean",
          "default": true
        },
        "position": {
          "title": "Sensors report position information?",
          "type": "boolean",
          "default": true
        },
        "orientation": {
          "title": "Sensors report orientation information?",
          "type": "boolean",
          "default": true
        }
      }
    },
    "analog": {
      "type": "object",
      "title": "Analog interface description",
      "description": "Describes properties of the analog interface provided by this device.",
      "properties": {
        "count": {
          "title": "Number of sensors/channels",
          "description": "number of analog channels reported",
          "type": "integer",
          "minimum": 1
        },
        "traits": {
          "title": "Per-channel traits",
          "description": "Entries in this array are mapped directly to analog channels - entry 0 describes channel 0, etc. Thus, if you want to describe channel n, you must describe channel n-1 (at least trivially with an empty object) down to 0.",
          "type": "array",
          "items": {
            "type": "object",
            "title": "Analog Channel Traits",
            "description": "Describes relevant properties of the analog data reported on this channel. In the case of a joystick, the 'rest' will likely be halfway between 'min' and 'max', while an analog button will likely have 'min' equal to 'rest'. These parameters may be used for scaling the data as requested by a client application or analysis module.",
            "properties": {
              "min": {
                "title": "Minimum value",
                "type": "number"
              },
              "max": {
                "title": "Maximum value",
                "type": "number"
              },
              "rest": {
                "title": "Value at rest",
                "type": "number"
              }
            }
          }
        }
      }
    },
    "button": {
      "type": "object",
      "title": "Button interface description",
      "description": "Describes properties of the button interface provided by this device.",
      "properties": {
        "count": {
          "title": "Number of channels",
          "description": "number of button channels reported",
          "type": "integer",
          "minimum": 1
        }
      }
    },
    "aliasBase": {
      "type": "string",
      "title": "Semantic alias",
      "pattern": "^[a-zA-Z]/[1-9][0-9]*$"
    },
    "trackerSensorAlias": {
      "allOf": [
        {
          "$ref": "#/definitions/aliasBase"
        },
        {
          "pattern": "^tracker/"
        }
      ]
    },
    "analogAlias": {
      "allOf": [
        {
          "$ref": "#/definitions/aliasBase"
        },
        {
          "pattern": "^analog/"
        }
      ]
    },
    "buttonAlias": {
      "allOf": [
        {
          "$ref": "#/definitions/aliasBase"
        },
        {
          "pattern": "^button/"
        }
      ]
    },
    "concreteAlias": {
      "anyOf": [
        {
          "$ref": "#/definitions/buttonAlias"
        },
        {
          "$ref": "#/definitions/trackerSensorAlias"
        },
        {
          "$ref": "#/definitions/analogAlias"
        }
      ]
    },
    "aliasGrouping": {
      "type": "object",
      "title": "Grouping for semantic aliases",
      "description": "A 'directory' on the semantic tree. May also contain an alias at its own level, described by '$target'",
      "properties": {
        "$target": {
          "$ref": "#/definitions/concreteAlias"
        }
      },
      "additionalProperties": {
        "$ref": "#/definitions/aliasNode"
      }
    },
    "aliasNode": {
      "anyOf": [
        {
          "$ref": "#/definitions/concreteAlias"
        },
        {
          "$ref": "#/definitions/aliasGrouping"
        }
      ]
    }
  },
  "type": "object",
  "properties": {
    "interfaces": {
      "type": "object",
      "properties": {
        "tracker": {
          "$ref": "#/definitions/tracker"
        },
        "analog": {
          "$ref": "#/definitions/analog"
        },
        "button": {
          "$ref": "#/definitions/button"
        }
      }
    },
    "semantic": {
      "type": "object",
      "additionalProperties": {
        "$ref": "#/definitions/aliasNode"
      }
    }
  }
}
